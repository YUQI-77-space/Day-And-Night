# 主角移动系统开发指南

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 主角移动系统开发指南 |
| 版本号 | v1.0 |
| 状态 | 设计定稿 |
| 关联文档 | 12_主角移动系统设定, 13_主角移动系统美术资源指导 |
| 前置条件 | 完成美术资源准备 |

---

## 一、开发准备

### 1.1 开发环境确认

**步骤1：确认Unity版本**
- 打开Unity Hub，查看项目使用的Unity版本
- 推荐版本：Unity 2022.3 LTS或更高
- 记录版本号：________________

**步骤2：确认项目结构**
- 在Unity中打开项目
- 确认以下文件夹存在：
  - Assets/_Project/Scripts/
  - Assets/_Project/Prefabs/
  - Assets/_Project/Scenes/
  - Assets/_Project/Art/
- 如果不存在，需要创建这些文件夹

**步骤3：导入必要的Package**
- 打开 Window > Package Manager
- 确认以下包已安装：
  - [ ] Input System（新版输入系统）
  - [ ] 2D Sprite Shape（如果使用Tilemap）
  - [ ] Universal Render Pipeline（如使用URP）

### 1.2 创建开发分支

**步骤1：在版本控制中创建分支**
- 使用Git创建新分支：feature/player-movement
- 切换到新分支进行开发

**步骤2：创建开发场景**
- 在Assets/_Project/Scenes/中创建新场景：PlayerMovement_Test.unity
- 保存场景

---

## 二、美术资源导入与配置

### 2.1 主角资源导入

**步骤1：创建资源文件夹**
- 在Assets/_Project/Art/中创建以下文件夹：
  ```
  Art/
  ├── Characters/
  │   └── Player/
  │       ├── Idle/
  │       ├── Walk/
  │       ├── Run/
  │       ├── Dodge/
  │       ├── Block/
  │       ├── Attack/
  │       └── Hit/
  ├── Weapons/
  ├── VFX/
  └── UI/
  ```

**步骤2：导入主角精灵图**
- 将主角Idle动画帧拖入Assets/_Project/Art/Characters/Player/Idle/
- 将主角Walk动画帧拖入Assets/_Project/Art/Characters/Player/Walk/
- 将主角Run动画帧拖入Assets/_Project/Art/Characters/Player/Run/
- 将主角Dodge动画帧拖入Assets/_Project/Art/Characters/Player/Dodge/
- 将主角Block动画帧拖入Assets/_Project/Art/Characters/Player/Block/
- 将主角Attack动画帧拖入Assets/_Project/Art/Characters/Player/Attack/
- 将主角Hit动画帧拖入Assets/_Project/Art/Characters/Player/Hit/

**步骤3：配置主角精灵导入设置**
- 选中主角Idle_Down.png（包含4帧的精灵表）
- 在Inspector中：
  - Sprite Mode: Multiple
  - Pixels Per Unit: 32
  - Filter Mode: Point (no filter)
  - Compression: None
- 点击Apply应用设置
- 点击Sprite Editor打开精灵编辑器
- 点击Slice，设置：
  - Type: Grid
  - Cell Size: 32 x 32
  - Offset: 0, 0
  - Pivot: Center
- 点击Apply完成切割
- 对其他所有主角精灵图重复此步骤

### 2.2 动画控制器配置

**步骤1：创建Animator Controller**
- 在Assets/_Project/Art/Characters/Player/中右键
- 选择Create > Animator Controller
- 命名为：PlayerAnimatorController
- 双击打开Animator窗口

**步骤2：创建动画Clip**
- 在Project窗口中选中Idle_Down精灵
- 拖入Animator窗口
- 右键重命名为：Idle_Down
- 重复此过程，创建所有动画Clip：
  - Idle_Down, Idle_Left, Idle_Right, Idle_Up
  - Walk_Down, Walk_Left, Walk_Right, Walk_Up
  - Run_Down, Run_Left, Run_Right, Run_Up
  - Dodge_Roll_Down, Dodge_Roll_Left, Dodge_Roll_Right, Dodge_Roll_Up
  - Dodge_Back
  - Dodge_Step_Left, Dodge_Step_Right
  - Block_Loop
  - Block_Hit
  - Block_Parry
  - Attack_Basic1_Down, Attack_Basic1_Left, Attack_Basic1_Right, Attack_Basic1_Up
  - Attack_Basic2_Down, Attack_Basic2_Left, Attack_Basic2_Right, Attack_Basic2_Up
  - Attack_Basic3_Down, Attack_Basic3_Left, Attack_Basic3_Right, Attack_Basic3_Up
  - Attack_Heavy_Down, Attack_Heavy_Left, Attack_Heavy_Right, Attack_Heavy_Up
  - Attack_Charge_Down, Attack_Charge_Left, Attack_Charge_Right, Attack_Charge_Up
  - Hit_Light
  - Hit_Heavy
  - Hit_Knockback
  - Death

**步骤3：设置动画属性**
- 选中每个动画Clip，在Inspector中设置：
  - Loop Time: 根据动画类型设置
  - Loop Pose: 待机/行走/奔跑动画设为true
  - Cycle Offset: 根据需要调整（防止动画同步）
- 设置Speed：
  - Idle: 1.0
  - Walk: 1.0
  - Run: 1.0
  - Dodge: 1.0-1.2
  - Attack: 1.0

### 2.3 动画状态机配置

**步骤1：创建Parameters**
- 在Animator窗口的Parameters面板中，点击+添加以下参数：
  - Float: Speed（用于移动状态混合）
  - Float: DirectionX（用于方向）
  - Float: DirectionY（用于方向）
  - Bool: IsRunning（用于切换行走/奔跑）
  - Bool: IsDodging（用于闪避状态）
  - Bool: IsBlocking（用于格挡状态）
  - Bool: IsAttacking（用于攻击状态）
  - Bool: IsHit（用于受击状态）
  - Bool: IsDead（用于死亡状态）
  - Trigger: DodgeTrigger（闪避触发器）
  - Trigger: AttackTrigger（攻击触发器）
  - Trigger: BlockParry（完美格挡触发器）

**步骤2：创建基础状态**
- 创建Any State（如果不存在）
- 创建Entry（默认状态入口）
- 创建Exit（退出状态）

**步骤3：组织状态层级**
- 创建Base Layer（主层）用于移动和战斗
- 创建Upper Layer（上层）用于覆盖攻击动画
- 创建Hit Layer（受击层）用于受击状态覆盖

**步骤4：创建状态转换规则**
- Idle ↔ Walk ↔ Run之间的转换（基于Speed参数）
- 任意状态 → Dodge（基于DodgeTrigger）
- 任意状态 → Block（基于IsBlocking）
- 任意状态 → Attack（基于AttackTrigger）
- 任意状态 → Hit（基于IsHit）
- 任意状态 → Death（基于IsDead）

---

## 三、主角Prefab创建

### 3.1 创建主角GameObject

**步骤1：创建空GameObject**
- 在Hierarchy中右键，选择Create Empty
- 命名为：Player
- 设置位置：(0, 0, 0)

**步骤2：添加Sprite Renderer**
- 右键Player > 2D Object > Sprites > Square
- 或添加Component > Sprite Renderer
- 设置Sorting Layer：
  - Order in Layer: 1
  - Sorting Layer: Characters
- 将默认Sprite暂时留空（后续关联动画）

**步骤3：添加Animator**
- 选择Player对象
- 添加Component > Animator
- 将PlayerAnimatorController拖入Controller槽位

**步骤4：添加Rigidbody2D**
- 添加Component > Rigidbody 2D
- 设置：
  - Body Type: Dynamic
  - Mass: 1
  - Linear Drag: 0
  - Angular Drag: 0.5
  - Gravity Scale: 1
  - Collision Detection: Continuous
  - Sleeping Mode: Start Awake
  - Interpolate: Interpolate

**步骤5：添加碰撞体**
- 添加Component > Capsule Collider 2D
- 设置：
  - Size: (0.8, 1.6)
  - Offset: (0, 0.2)
- 如果需要，添加额外的碰撞体

**步骤6：设置层级**
- 在Inspector中设置Layer为：Player
- 设置Tag为：Player

### 3.2 创建武器挂载点

**步骤1：创建子对象**
- 在Player下创建空GameObject，命名为：WeaponContainer
- 在WeaponContainer下创建空GameObject，命名为：Hand_R（右手）
- 设置Hand_R位置为角色右手位置（如：(0.3, 0.1, 0)）

**步骤2：创建武器Sprite容器**
- 在Hand_R下创建Sprite Renderer
- 设置Sorting Order为：2（在角色之上）

### 3.3 创建阴影

**步骤1：创建阴影对象**
- 在Player下创建Sprite Renderer
- 设置Sprite为圆形阴影（VFX_Shadow）
- 设置：
  - Position: (0, -0.8, 0)
  - Scale: (1.2, 0.3, 1)
  - Sorting Order: -1（在角色脚下）
  - Color: 黑色，透明度50%

### 3.4 保存为Prefab

**步骤1：创建Prefab**
- 在Project窗口中Assets/_Project/Prefabs/文件夹
- 将Hierarchy中的Player对象拖入Project窗口
- 创建Prefab

**步骤2：配置Prefab变体（如需要）**
- 右键Prefab > Create > Prefab Variant
- 命名为：Player_Night（夜晚版本）

**步骤3：备份原场景**
- 将当前场景保存为：PlayerMovement_Test.unity

---

## 四、输入系统配置

### 4.1 创建输入管理器

**步骤1：创建输入配置**
- 在Assets/_Project/Scripts/中创建文件夹：Input/
- 创建C#脚本：PlayerInputManager.cs
- （此步骤为代码开发，后续详细说明）

**步骤2：配置输入映射**
- 如果使用New Input System：
  - 创建Input Actions Asset：PlayerControls.inputactions
  - 配置以下Action Map：
    - Movement（用于移动）
    - Combat（用于战斗）
  - 配置以下Action：
    - Move: Vector2（用于方向输入）
    - Run: Button（用于奔跑）
    - Dodge: Button（用于闪避）
    - Attack: Button（用于攻击）
    - Block: Button（用于格挡）
    - HeavyAttack: Button（用于重击）
    - Skill1: Button（用于技能1）
    - Skill2: Button（用于技能2）

**步骤3：设置输入设备**
- 确认支持以下设备：
  - Keyboard & Mouse
  - Gamepad（Xbox/PlayStation风格）
- 在Player Settings > Input Manager中确认

### 4.2 输入测试场景

**步骤1：创建测试环境**
- 打开PlayerMovement_Test.unity
- 创建一个简单的地面：
  - GameObject > 2D Object > Sprites > Square
  - 设置Scale: (100, 1, 1)
  - 添加Box Collider 2D
  - 设置Sorting Layer: Background
- 创建四面墙壁防止角色走出测试区域

**步骤2：放置主角**
- 将Player Prefab拖入场景
- 设置位置：(0, 1, 0)

**步骤3：创建UI**
- 创建Canvas
- 添加Text显示当前输入状态
- 添加按钮测试各种输入

---

## 五、移动脚本开发准备

### 5.1 创建脚本框架

**步骤1：创建基础脚本**
- 在Assets/_Project/Scripts/中创建文件夹：Player/
- 创建以下C#脚本框架（具体代码后续开发）：
  - PlayerController.cs（主控制器）
  - PlayerMovement.cs（移动逻辑）
  - PlayerDodge.cs（闪避逻辑）
  - PlayerBlock.cs（格挡逻辑）
  - PlayerAttack.cs（攻击逻辑）
  - PlayerStamina.cs（耐力系统）
  - PlayerAnimation.cs（动画控制）

**步骤2：创建状态枚举**
- 创建PlayerState.cs：
  ```csharp
  public enum PlayerState
  {
      Idle,
      Walking,
      Running,
      Dodging,
      Blocking,
      Attacking,
      Hit,
      Dead
  }
  ```

**步骤3：创建移动参数配置**
- 创建PlayerMovementData.cs：
  ```csharp
  [CreateAssetMenu(fileName = "PlayerMovementData", menuName = "Player/Movement Data")]
  public class PlayerMovementData : ScriptableObject
  {
      // 速度配置
      public float walkSpeed = 3.0f;
      public float runSpeed = 4.5f;
      public float combatSpeed = 4.0f;
      public float sprintSpeed = 6.0f;
      
      // 闪避配置
      public float dodgeDistance = 3.0f;
      public float dodgeDuration = 0.3f;
      public float dodgeCooldown = 0.8f;
      public int maxDodgeCombo = 2;
      
      // 格挡配置
      public float blockDamageReduction = 0.6f;
      public float parryWindow = 0.1f;
      
      // 耐力配置
      public float maxStamina = 100f;
      public float staminaRecovery = 15f;
      public float staminaDelay = 1.0f;
  }
  ```

### 5.2 配置主角引用

**步骤1：创建组件引用**
- 后续在PlayerController.cs中需要引用以下组件：
  - Rigidbody2D
  - Animator
  - SpriteRenderer
  - CapsuleCollider2D

**步骤2：创建事件系统**
- 创建PlayerEvents.cs用于组件间通信：
  ```csharp
  public static class PlayerEvents
  {
      public static System.Action<PlayerState> OnStateChanged;
      public static System.Action<float> OnStaminaChanged;
      public static System.Action<float> OnHealthChanged;
      public static System.Action OnDodge;
      public static System.Action OnBlock;
      public static System.Action OnAttack;
      public static System.Action OnHit;
      public static System.Action OnDeath;
  }
  ```

---

## 六、场景测试配置

### 6.1 创建测试关卡

**步骤1：创建基础地面**
- 使用Tilemap或Sprite创建测试地面
- 至少需要50x50单位的可移动区域
- 添加适当的碰撞体

**步骤2：添加障碍物**
- 在场景中放置一些障碍物测试碰撞：
  - 箱子
  - 墙壁
  - 台阶（测试爬坡）
- 确保障碍物有Collider 2D

**步骤3：添加测试道具**
- 创建一些可拾取物品测试碰撞检测
- 创建NPC测试对话交互

### 6.2 配置相机

**步骤1：添加相机跟随**
- 创建或配置主相机
- 添加CameraFollow脚本（后续开发）
- 设置相机参数：
  - Size: 5-10
  - Background: 黑色或项目默认背景
  - Projection: Orthographic

**步骤2：测试相机跟随**
- 移动主角测试相机跟随
- 调整跟随平滑度和偏移

### 6.3 添加调试工具

**步骤1：创建调试UI**
- 在Canvas中添加调试面板
- 显示以下信息：
  - 当前状态
  - 移动速度
  - 耐力值
  - 动画状态

**步骤2：添加Gizmos**
- 在脚本中添加OnDrawGizmos用于调试：
  - 显示移动方向
  - 显示攻击范围
  - 显示闪避路径

---

## 七、移动系统核心功能开发步骤

### 7.1 基础移动开发

**步骤1：实现移动输入读取**
- 在PlayerMovement.cs中读取输入
- 转换为移动向量
- 应用到Rigidbody2D

**步骤2：实现速度控制**
- 根据状态切换移动速度
- 实现行走/奔跑切换
- 实现加速和减速

**步骤3：实现方向处理**
- 处理八方向移动
- 处理对角线移动的规范化
- 实现方向平滑过渡

**步骤4：实现碰撞检测**
- 使用Rigidbody2D的碰撞检测
- 处理墙壁碰撞
- 处理地形碰撞

### 7.2 动画状态同步开发

**步骤1：实现状态参数同步**
- 将移动状态同步到Animator
- 实现Idle/Walk/Run之间的混合
- 实现方向参数同步

**步骤2：实现事件触发**
- 在动画中添加事件点
- 触发攻击命中判定
- 触发音效播放

**步骤3：实现动画取消**
- 实现闪避取消攻击后摇
- 实现格挡取消攻击
- 实现攻击取消移动

### 7.3 闪避系统开发

**步骤1：实现闪避输入**
- 检测闪避按键输入
- 验证闪避条件（耐力、冷却、状态）

**步骤2：实现闪避位移**
- 计算闪避方向
- 使用Coroutines或Tween实现位移
- 实现无敌帧检测

**步骤3：实现闪避冷却**
- 设置冷却时间
- 实现冷却UI更新
- 实现连续闪避惩罚

**步骤4：实现闪避动画**
- 根据输入方向播放对应动画
- 同步位移和动画时间
- 处理闪避结束状态

### 7.4 格挡系统开发

**步骤1：实现格挡输入**
- 检测格挡按键按下和抬起
- 设置格挡状态

**步骤2：实现格挡判定**
- 检测敌人攻击
- 判断格挡时机
- 实现完美格挡判定

**步骤3：实现格挡效果**
- 计算伤害减免
- 触发格挡反馈（视觉效果、音效）
- 实现格挡反击

**步骤4：实现格挡消耗**
- 持续消耗耐力
- 监控耐力状态
- 处理耐力不足

### 7.5 攻击系统开发

**步骤1：实现攻击输入**
- 检测普通攻击按键
- 检测重击蓄力
- 实现连击系统

**步骤2：实现攻击动画**
- 播放对应方向的攻击动画
- 实现三连击逻辑
- 实现蓄力动画

**步骤3：实现攻击判定**
- 在攻击动画特定帧触发判定
- 使用Collider或Raycast检测敌人
- 计算伤害

**步骤4：实现攻击效果**
- 播放攻击特效
- 播放命中特效
- 触发镜头震动

---

## 八、耐力系统开发

### 8.1 耐力数据管理

**步骤1：创建耐力数据**
- 创建PlayerStamina.cs脚本
- 定义最大耐力值
- 定义当前耐力值
- 定义恢复速度

**步骤2：实现耐力恢复**
- 在耐力消耗后开始计时
- 计时结束后开始恢复
- 达到最大值时停止恢复

**步骤3：实现耐力状态**
- 定义耐力状态（充足/低/枯竭/空）
- 根据当前耐力更新状态
- 将状态变化通知其他系统

### 8.2 耐力消耗规则

**步骤1：定义消耗表**
| 动作 | 消耗 | 持续消耗 |
|------|------|----------|
| 奔跑 | 0 | 10点/秒 |
| 翻滚 | 25点 | - |
| 后跳 | 20点 | - |
| 闪步 | 30点 | - |
| 格挡 | 0 | 5点/秒（白天）/8点/秒（夜晚） |
| 普通攻击 | 5-10点 | - |
| 重击 | 15-25点 | - |
| 技能释放 | 20-40点 | - |

**步骤2：实现消耗逻辑**
- 在动作开始时扣除耐力
- 对于持续消耗，在Update中扣除
- 检查耐力是否足够

**步骤3：实现耐力不足处理**
- 耐力低时显示警告
- 耐力枯竭时禁止消耗动作
- 耐力恢复后解除限制

### 8.3 耐力UI实现

**步骤1：创建耐力条UI**
- 创建UI Image用于耐力条背景
- 创建UI Image用于耐力条前景
- 创建UI Text用于显示数值

**步骤2：实现UI更新**
- 订阅OnStaminaChanged事件
- 在事件回调中更新UI
- 实现数值变化动画

**步骤3：添加特殊状态显示**
- 低耐力时显示闪烁效果
- 耐力枯竭时显示红色警告
- 恢复中显示恢复动画

---

## 九、阶段切换系统开发

### 9.1 时间系统集成

**步骤1：创建时间管理器**
- 在场景中添加TimeManager对象
- 创建TimeManager.cs脚本
- 实现时间流逝逻辑

**步骤2：实现阶段切换触发**
- 在TimeManager中添加阶段切换事件
- 在18:00触发白天→夜晚切换
- 在06:00触发夜晚→白天切换

**步骤3：通知玩家系统**
- 在阶段切换时广播事件
- PlayerController订阅阶段切换事件
- 根据阶段调整移动参数

### 9.2 移动参数动态调整

**步骤1：创建参数调整逻辑**
| 参数 | 白天值 | 夜晚值 | 调整方式 |
|------|--------|--------|----------|
| 基础速度 | 3.0 | 4.0 | 立即切换 |
| 奔跑速度 | 4.5 | 6.0 | 立即切换 |
| 闪避冷却 | 0.8 | 0.6 | 立即切换 |
| 闪避耐力消耗 | 25 | 20 | 立即切换 |
| 格挡持续消耗 | 5 | 8 | 立即切换 |

**步骤2：实现平滑过渡**
- 对于需要平滑过渡的参数使用Lerp
- 设置过渡时间：0.5-1秒
- 在Update中更新当前值

**步骤3：实现状态重置**
- 夜晚开始时：
  - 恢复满耐力
  - 清除异常状态
  - 切换到战斗状态
- 白天开始时：
  - 恢复满生命值
  - 恢复满耐力
  - 切换到探索状态

---

## 十、碰撞与物理系统配置

### 10.1 碰撞体层级配置

**步骤1：设置Physics 2D Layers**
- 在Edit > Project Settings > Physics 2D中添加Layer：
  - Player
  - Enemy
  - NPC
  - Wall
  - Ground
  - Item
  - Trap

**步骤2：配置碰撞矩阵**
|  | Player | Enemy | NPC | Wall | Ground | Item | Trap |
|--|--------|-------|-----|------|--------|------|------|
| Player | - | √ | √ | √ | √ | √ | √ |
| Enemy | √ | √ | - | √ | √ | - | - |
| NPC | √ | - | - | √ | √ | - | - |
| Wall | √ | √ | √ | - | - | - | - |
| Ground | √ | √ | √ | - | - | - | - |
| Item | √ | - | - | - | - | - | - |
| Trap | √ | - | - | - | - | - | - |

**步骤3：配置碰撞掩码**
- 在Player的Rigidbody2D中设置Collision Mask
- 只与需要的层级碰撞

### 10.2 物理参数调整

**步骤1：调整主角物理参数**
| 参数 | 推荐值 | 说明 |
|------|--------|------|
| Mass | 1 | 保持默认 |
| Linear Drag | 0 | 允许滑行 |
| Gravity Scale | 0 | 2D俯视角不需要重力 |
| Sleep Mode | Start Awake | 保持唤醒 |
| Collision Detection | Continuous | 防止穿墙 |

**步骤2：调整移动参数**
| 参数 | 推荐值 | 说明 |
|------|--------|------|
| 移动加速度 | 50 | 响应速度 |
| 移动减速度 | 30 | 停止平滑度 |
| 转向速度 | 100 | 方向切换速度 |

### 10.3 碰撞回调处理

**步骤1：实现OnCollisionEnter2D**
- 检测碰撞对象
- 根据碰撞类型处理
- 触发相应事件

**步骤2：实现OnTriggerEnter2D**
- 检测触发器碰撞
- 处理物品拾取
- 处理区域触发

---

## 十一、完整测试检查清单

### 11.1 功能测试

- [ ] 基础移动（四个方向）
- [ ] 对角线移动
- [ ] 行走切换奔跑
- [ ] 奔跑切换行走
- [ ] 停止移动
- [ ] 闪避（各方向）
- [ ] 连续闪避
- [ ] 闪避冷却
- [ ] 格挡（按住）
- [ ] 格挡成功判定
- [ ] 完美格挡
- [ ] 格挡反击
- [ ] 格挡耐力消耗
- [ ] 普通攻击
- [ ] 三连击
- [ ] 重击蓄力
- [ ] 蓄力释放
- [ ] 攻击闪避取消
- [ ] 攻击格挡取消
- [ ] 受击反馈
- [ ] 死亡动画
- [ ] 耐力恢复
- [ ] 耐力不足处理
- [ ] 白天/夜晚切换
- [ ] 阶段参数调整

### 11.2 输入测试

- [ ] 键盘WASD移动
- [ ] 键盘Shift奔跑
- [ ] 空格闪避
- [ ] 鼠标右键格挡
- [ ] 鼠标左键攻击
- [ ] 长按鼠标左键重击
- [ ] Q技能1
- [ ] Z技能2
- [ ] 鼠标滚轮切换武器
- [ ] 鼠标中键锁定
- [ ] 手柄摇杆移动
- [ ] 手柄按钮攻击
- [ ] 手柄肩键技能
- [ ] 手柄扳机格挡

### 11.3 边界测试

- [ ] 穿墙测试
- [ ] 斜坡移动测试
- [ ] 障碍物碰撞测试
- [ ] 边缘掉落测试
- [ ] 快速输入测试
- [ ] 连续攻击测试
- [ ] 极限耐力测试
- [ ] 网络延迟测试（如适用）

### 11.4 性能测试

- [ ] 移动帧率测试
- [ ] 动画切换测试
- [ ] 大量对象场景测试
- [ ] 长时间运行测试
- [ ] 内存占用测试

---

## 十二、调试与优化

### 12.1 调试工具

**步骤1：创建调试脚本**
- 创建DebugPanel.cs脚本
- 显示当前状态信息
- 提供调试控制按钮

**步骤2：添加日志输出**
- 在关键节点添加Debug.Log
- 使用Debug.LogWarning和Debug.LogError区分级别
- 可通过宏控制日志输出

**步骤3：添加可视化调试**
- 使用Gizmos显示移动方向
- 使用Gizmos显示攻击范围
- 使用LineRenderer显示轨迹

### 12.2 性能优化

**步骤1：动画优化**
- 使用Animation Curve控制动画速度
- 减少不必要的动画混合
- 使用Animation Events减少Update调用

**步骤2：物理优化**
- 减少碰撞体复杂度
- 使用合适的Collision Detection模式
- 合理设置Physics2DIterations

**步骤3：内存优化**
- 精灵图使用Sprite Atlas
- 动态加载不使用资源
- 及时销毁临时对象

### 12.3 Bug修复流程

**步骤1：问题记录**
- 记录Bug现象
- 记录复现步骤
- 记录环境和版本

**步骤2：问题定位**
- 使用调试工具定位
- 添加断点调试
- 分析日志输出

**步骤3：修复验证**
- 修复后测试验证
- 记录修复方法
- 更新文档和测试用例

---

## 十三、后续开发标记

以下是需要代码开发的模块，后续将逐个实现：

### 13.1 脚本开发优先级

| 优先级 | 脚本 | 说明 |
|--------|------|------|
| P0 | PlayerInputManager.cs | 输入系统 |
| P0 | PlayerMovement.cs | 基础移动 |
| P0 | PlayerAnimation.cs | 动画控制 |
| P1 | PlayerDodge.cs | 闪避系统 |
| P1 | PlayerBlock.cs | 格挡系统 |
| P1 | PlayerAttack.cs | 攻击系统 |
| P1 | PlayerStamina.cs | 耐力系统 |
| P2 | PlayerCombat.cs | 战斗整合 |
| P2 | PlayerEvents.cs | 事件系统 |
| P3 | PlayerStateManager.cs | 状态管理 |

### 13.2 待实现功能

| 功能 | 状态 | 关联脚本 |
|------|------|----------|
| 八方向移动 | 待开发 | PlayerMovement |
| 奔跑机制 | 待开发 | PlayerMovement |
| 闪避系统 | 待开发 | PlayerDodge |
| 格挡系统 | 待开发 | PlayerBlock |
| 攻击系统 | 待开发 | PlayerAttack |
| 耐力系统 | 待开发 | PlayerStamina |
| 动画同步 | 待开发 | PlayerAnimation |
| 状态机 | 待开发 | PlayerStateManager |
| 阶段切换 | 待开发 | PlayerMovement |
| 输入系统 | 待开发 | PlayerInputManager |

---

## 十四、常见问题处理

### Q1：角色移动不流畅怎么办？

**检查项**：
- Rigidbody2D的Interpolate设置
- 移动加速度参数
- 动画过渡时间

### Q2：动画切换卡顿怎么办？

**检查项**：
- 动画状态机的过渡设置
- 是否使用了立即切换
- 动画事件是否正确

### Q3：碰撞检测不准确怎么办？

**检查项**：
- 碰撞体大小和位置
- Collision Detection设置
- Physics2DIterations设置

### Q4：闪避无敌帧不生效怎么办？

**检查项**：
- 无敌帧时间是否正确
- 是否在无敌帧期间禁用了碰撞
- 敌人攻击判定时机

---

## 十五、文档修订记录

| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2026-02-03 | 初版完成 | 开发者 |

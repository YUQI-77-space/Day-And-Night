# 主角移动系统设定

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 主角移动系统设定 |
| 版本号 | v1.0 |
| 状态 | 设计定稿 |
| 关联文档 | 01_CoreGameplay, 03_CombatSystem, 08_ArtStyleGuide |

---

## 一、系统概述

### 1.1 设计目标

主角移动系统是游戏的核心基础系统，需要同时服务于游戏的两个核心阶段：

- **白天阶段（06:00-18:00）**：支持自由探索、NPC互动、环境交互
- **夜晚阶段（18:00-24:00）**：支持实时动作战斗，包括快速移动、闪避、位移技能

### 1.2 设计原则

1. **一致性**：无论白天黑夜，移动操作保持统一，玩家无需重新学习
2. **差异化**：移动速度和机动性在不同阶段有明显区别
3. **响应性**：输入反馈即时，操作手感流畅
4. **可扩展性**：支持未来添加新的移动能力和状态

---

## 二、移动能力详细设计

### 2.1 基础移动（Always Available）

#### 移动速度

| 阶段 | 移动类型 | 速度值 | 说明 |
|------|---------|--------|------|
| 白天 | 行走 | 3.0 m/s | 探索模式，可以自由观察环境 |
| 白天 | 奔跑 | 4.5 m/s | 按住Shift加速，用于赶时间 |
| 夜晚 | 战斗移动 | 4.0 m/s | 基础战斗状态移动速度 |
| 夜晚 | 冲刺 | 6.0 m/s | 仅在耐力允许时可用 |

#### 移动方向

- **支持八方向移动**：上、下、左、右，及四个对角线方向
- **方向优先级**：当同时按下多个方向键时，按照固定优先级处理
  - 优先级：上 > 下 > 左 > 右（数值较小方向优先）

#### 加速机制

| 条件 | 加速效果 | 持续时间 |
|------|---------|----------|
| 按住Shift键 | 速度+50% | 持续按键，耐力耗尽停止 |
| 耐力低于20% | 无法奔跑 | 恢复至30%后解锁 |
| 处于危险区域 | 自动奔跑 | 离开危险区域停止 |
| 被敌人追击 | 强制奔跑 | 进入安全区域停止 |

### 2.2 闪避系统（Dodge）

闪避是战斗中的核心生存能力，提供无敌帧和位移效果。

#### 闪避类型

| 类型 | 按键 | 消耗耐力 | 无敌帧时长 | 位移距离 | 冷却时间 |
|------|------|---------|------------|----------|----------|
| 翻滚 | 空格（单按） | 25点 | 0.3秒 | 3.0米 | 0.8秒 |
| 后跳 | 空格+后退 | 20点 | 0.25秒 | 2.5米 | 0.6秒 |
| 闪步 | 空格+方向 | 30点 | 0.2秒 | 4.0米 | 1.0秒 |

#### 闪避特殊规则

1. **闪避取消**：闪避中可以取消进入攻击动作（减少后摇）
2. **闪避反击**：闪避结束后0.15秒内按下攻击键，触发闪避反击
3. **连续闪避**：最多连续闪避2次，第3次闪避消耗双倍耐力
4. **闪避耐力惩罚**：连续闪避后耐力恢复延迟2秒

#### 属性对闪避的影响

| 属性 | 阈值 | 闪避效果 |
|------|------|----------|
| 技巧 | 20+ | 闪避消耗-10% |
| 技巧 | 40+ | 闪避无敌帧+0.05秒 |
| 技巧 | 60+ | 闪避后可立即进行攻击 |
| 勇气 | 30+ | 闪避冷却-0.1秒 |
| 力量 | 50+ | 闪避位移距离+0.5米 |

### 2.3 格挡系统（Block）

格挡提供防御能力，减少伤害并可能触发反击。

#### 格挡机制

| 状态 | 按键 | 耐力消耗 | 伤害减免 | 说明 |
|------|------|---------|----------|------|
| 格挡中 | 按住右键 | 5点/秒 | 60% | 持续按住维持 |
| 格挡成功 | - | 0 | 额外-20% | 成功格挡敌人攻击 |
| 完美格挡 | 时机精准 | 0 | 100% | 在攻击命中前0.1秒内格挡 |
| 格挡反击 | 格挡后攻击 | 0 | - | 触发反击动作 |

#### 格挡特殊效果

| 效果 | 触发条件 | 效果内容 |
|------|----------|----------|
| 格挡反击 | 格挡成功后立即攻击 | 造成120%伤害的反击 |
| 完美格挡 | 完美时机格挡 | 敌人进入0.5秒硬直 |
| 格挡破防 | 连续格挡5次 | 消耗格挡者额外耐力 |

#### 属性对格挡的影响

| 属性 | 阈值 | 格挡效果 |
|------|------|----------|
| 力量 | 20+ | 格挡伤害减免+5% |
| 力量 | 40+ | 格挡反击伤害+20% |
| 勇气 | 25+ | 完美格挡判定时间+0.05秒 |
| 勇气 | 50+ | 格挡时不会后退 |

### 2.4 攻击移动（Combat Movement）

攻击时的移动受到限制，但仍保持一定的机动性。

#### 攻击类型与移动

| 攻击类型 | 移动能力 | 移动速度 | 攻击期间 |
|---------|---------|----------|----------|
| 普通攻击 | 不可移动 | 0 | 完整攻击动画 |
| 重击蓄力 | 缓慢移动 | 1.0 m/s | 蓄力期间 |
| 技能释放 | 不可移动 | 0 | 吟唱/释放期间 |
| 攻击后摇 | 闪避取消 | - | 后摇可被闪避取消 |

#### 位移技能

| 技能名称 | 按键 | 消耗 | 位移距离 | 效果 |
|----------|------|------|----------|------|
| 冲刺斩 | 方向+攻击 | 15耐力 | 3米 | 位移+伤害 |
| 瞬身 | Q（需解锁） | 30耐力 | 5米 | 穿越敌人，短暂无敌 |
| 回旋斩 | Z（需解锁） | 25耐力 | 2米 | 360度攻击 |

---

## 三、移动状态机

### 3.1 状态定义

```
┌─────────────────────────────────────────────────────────────┐
│                        移动状态机                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────┐    输入移动      ┌─────────┐                  │
│   │  待机   │ ──────────────→ │  行走   │                  │
│   │ Idle    │ ←────────────── │  Walk   │                  │
│   └────┬────┘    停止输入      └────┬────┘                  │
│        │                            │                       │
│        │ 按住Shift                 │ 按住Shift             │
│        ↓                            ↓                       │
│   ┌─────────┐                   ┌─────────┐                │
│   │  奔跑   │                   │  奔跑   │                │
│   │  Run    │                   │  Run    │                │
│   └────┬────┘                   └────┬────┘                │
│        │                            │                       │
│        │ 输入攻击                  │ 输入攻击              │
│        ↓                            ↓                       │
│   ┌─────────┐    攻击结束       ┌─────────┐                │
│   │ 普通攻击│ ←─────────────── │ 普通攻击│                │
│   │ Attack  │                  │ Attack  │                │
│   └────┬────┘                  └────┬────┘                │
│        │                            │                       │
│        │ 按空格                    │ 按空格                │
│        ↓                            ↓                       │
│   ┌─────────┐    闪避结束        ┌─────────┐               │
│   │  闪避   │ ←─────────────── │  闪避   │               │
│   │  Dodge  │                  │  Dodge  │               │
│   └────┬────┘                  └────┬────┘               │
│        │                            │                       │
│        │ 按住右键                  │ 完美格挡              │
│        ↓                            ↓                       │
│   ┌─────────┐                   ┌─────────┐                │
│   │  格挡   │                   │ 完美格挡│                │
│   │  Block  │                   │ Parry   │                │
│   └────┬────┘                   └─────────┘                │
│        │                                                   │
│        │ 受伤/被击飞                                        │
│        ↓                                                   │
│   ┌─────────┐                                             │
│   │ 受击硬直 │                                             │
│   │  HitStun│                                             │
│   └────┬────┘                                             │
│        │                                                   │
│        │ 硬直结束                                          │
│        ↓                                                   │
│   ┌─────────┐                                             │
│   │  死亡   │                                             │
│   │  Death  │                                             │
│   └─────────┘                                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 状态转换规则

| 当前状态 | 转换条件 | 目标状态 | 优先级 |
|---------|---------|---------|--------|
| 任意 | 玩家死亡 | 死亡 | 1（最高） |
| 任意 | 受到击飞效果 | 受击硬直 | 2 |
| 任意 | 血量归零（不致死） | 受击硬直 | 3 |
| 待机/行走/奔跑 | 按空格 | 闪避 | 4 |
| 待机/行走/奔跑 | 按住右键 | 格挡 | 5 |
| 待机/行走/奔跑 | 输入攻击 | 普通攻击 | 6 |
| 普通攻击 | 攻击结束 | 待机 | 7 |
| 格挡 | 松开右键 | 待机 | 8 |
| 格挡 | 成功格挡 | 格挡（保持） | 9 |
| 格挡 | 完美格挡 | 完美格挡 | 10 |
| 闪避 | 闪避结束 | 待机 | 11 |

### 3.3 状态持续时间

| 状态 | 最短时间 | 最长时间 | 退出条件 |
|------|---------|---------|----------|
| 待机 | - | - | 任何输入 |
| 行走 | 0.1秒 | - | 停止输入/切换奔跑 |
| 奔跑 | 0.2秒 | 持续（耐力限制） | 停止输入/耐力耗尽 |
| 普通攻击 | 0.3秒 | 1.0秒 | 动画结束/闪避取消 |
| 蓄力重击 | 0.5秒 | 2.0秒 | 松开按键/蓄力完成/取消 |
| 闪避 | 0.3秒 | 0.5秒 | 动画结束 |
| 格挡 | 0.1秒 | 持续 | 松开按键/被攻击 |
| 完美格挡 | 0.1秒 | 0.2秒 | 时间结束/反击 |
| 受击硬直 | 0.2秒 | 1.5秒 | 硬直结束/再次受伤 |
| 死亡 | 0.5秒 | 2.0秒 | 复活/重新开始 |

---

## 四、阶段切换与移动变化

### 4.1 白天到夜晚的切换

当时间到达18:00时，系统自动执行以下切换：

#### 切换流程

```
18:00:00 - 切换开始
  │
  ├─ 播放切换过渡动画（2秒）
  │   ├─ 画面逐渐变暗
  │   ├─ 播放音效：夜晚来临
  │   └─ 显示提示："夜晚降临，怪物即将出现"
  │
  ├─ 玩家位置检查
  │   ├─ 如果在安全区：允许自由移动
  │   └─ 如果在危险区：强制传送至最近安全区
  │
  ├─ 状态重置
  │   ├─ 恢复满耐力
  │   ├─ 清除异常状态
  │   └─ 装备切换至战斗状态
  │
  └─ 18:00:02 - 切换完成
```

#### 移动参数变化

| 参数 | 白天 | 夜晚 | 变化幅度 |
|------|------|------|----------|
| 基础移动速度 | 3.0 m/s | 4.0 m/s | +33% |
| 奔跑速度 | 4.5 m/s | 6.0 m/s | +33% |
| 闪避冷却 | 0.8秒 | 0.6秒 | -25% |
| 闪避耐力消耗 | 25点 | 20点 | -20% |
| 格挡持续消耗 | 5点/秒 | 8点/秒 | +60% |

### 4.2 夜晚到白天的切换

当时间到达06:00时，系统自动执行以下切换：

#### 切换流程

```
06:00:00 - 切换开始
  │
  ├─ 播放切换过渡动画（2秒）
  │   ├─ 画面逐渐变亮
  │   ├─ 播放音效：黎明到来
  │   └─ 显示提示："新的一天开始"
  │
  ├─ 战斗结算
  │   ├─ 统计战斗数据
  │   ├─ 发放战斗奖励
  │   └─ 清理战场
  │
  ├─ 状态恢复
  │   ├─ 恢复满生命值
  │   ├─ 恢复满耐力
  │   └─ 清除战斗异常状态
  │
  ├─ 位置重置（如需要）
  │   └─ 如果在战斗区域，自动返回住所
  │
  └─ 06:00:02 - 切换完成
```

#### 移动参数变化

| 参数 | 夜晚 | 白天 | 变化幅度 |
|------|------|------|----------|
| 基础移动速度 | 4.0 m/s | 3.0 m/s | -25% |
| 奔跑速度 | 6.0 m/s | 4.5 m/s | -25% |
| 闪避冷却 | 0.6秒 | 0.8秒 | +33% |
| 闪避耐力消耗 | 20点 | 25点 | +25% |
| 格挡持续消耗 | 8点/秒 | 5点/秒 | -37.5% |

---

## 五、耐力系统

### 5.1 耐力数值

| 参数 | 数值 |
|------|------|
| 最大耐力值 | 100点 |
| 初始耐力值 | 100点 |
| 耐力恢复速度 | 15点/秒 |
| 耐力恢复延迟 | 1.0秒（停止消耗后） |

### 5.2 移动消耗

| 动作 | 消耗 | 持续消耗 |
|------|------|----------|
| 行走 | 0 | 0点/秒 |
| 奔跑 | 0 | 10点/秒 |
| 翻滚 | 25点 | - |
| 后跳 | 20点 | - |
| 闪步 | 30点 | - |
| 格挡 | 0 | 5点/秒（白天）/8点/秒（夜晚） |
| 普通攻击 | 5-10点 | - |
| 重击 | 15-25点 | - |
| 技能释放 | 20-40点 | - |

### 5.3 属性对耐力的影响

| 属性 | 阈值 | 效果 |
|------|------|------|
| 力量 | 20+ | 最大耐力+10 |
| 力量 | 40+ | 最大耐力+20 |
| 力量 | 60+ | 耐力恢复速度+5点/秒 |
| 技巧 | 30+ | 移动耐力消耗-10% |
| 技巧 | 50+ | 闪避耐力消耗-15% |

### 5.4 耐力状态

| 耐力状态 | 阈值 | 效果 |
|----------|------|------|
| 充足 | >30点 | 正常移动和战斗 |
| 低 | 20-30点 | 警告提示，奔跑减速 |
| 枯竭 | <20点 | 无法奔跑，无法闪避 |
| 空 | 0点 | 无法进行任何消耗耐力的动作 |

---

## 六、碰撞与物理

### 6.1 碰撞体设置

| 参数 | 数值 |
|------|------|
| 碰撞体类型 | Capsule Collider 2D |
| 碰撞体大小 | 宽0.8米，高1.6米 |
| 偏移位置 | 中心偏上（脚部对齐） |
| 层级 | Player |

### 6.2 移动物理参数

| 参数 | 数值 |
|------|------|
| 移动加速度 | 50 m/s² |
| 移动减速度 | 30 m/s² |
| 奔跑加速度 | 80 m/s² |
| 奔跑减速度 | 50 m/s² |
| 转向速度 | 100 deg/s |
| 最大爬坡角度 | 45度 |
| 地面检测距离 | 0.1米 |

### 6.3 碰撞处理规则

1. **与墙壁碰撞**：停止垂直于墙壁方向的移动
2. **与NPC碰撞**：触发对话/交互，可设置穿透
3. **与敌人碰撞**：检测为受击判定
4. **与陷阱碰撞**：触发陷阱效果
5. **与可拾取物碰撞**：自动拾取或提示拾取

---

## 七、控制方案

### 7.1 默认按键映射

| 功能 | 默认按键 | 替代按键（手柄） |
|------|----------|-----------------|
| 向上移动 | W | 左摇杆上 |
| 向下移动 | S | 左摇杆下 |
| 向左移动 | A | 左摇杆左 |
| 向右移动 | D | 左摇杆右 |
| 奔跑 | Shift | 左摇杆按下（L3） |
| 普通攻击 | 鼠标左键 | X键（A） |
| 重击 | 长按鼠标左键 | 长按X键 |
| 格挡 | 鼠标右键 | Y键（B） |
| 闪避 | 空格 | B键 |
| 技能1 | Q | LB键 |
| 技能2 | Z | RB键 |
| 切换武器 | 鼠标滚轮 | 十字键上下 |
| 锁定目标 | 鼠标中键 | 右摇杆按下（R3） |

### 7.2 辅助功能设置

| 设置项 | 选项 | 说明 |
|--------|------|------|
| 移动死区 | 0.1 - 0.5 | 摇杆最小输入阈值 |
| 奔跑切换 | 开关/长按 | 奔跑的激活方式 |
| 闪避方向 | 智能/固定 | 闪避时的方向判定 |
| 自动奔跑 | 开/关 | 是否支持自动持续奔跑 |
| 移动震动 | 开/关 | 移动时的触觉反馈 |

---

## 八、动画需求

### 8.1 主角动画列表

| 动画名称 | 帧数 | 方向 | 用途 |
|----------|------|------|------|
| Idle_Down | 4帧 | 1方向 | 待机状态 |
| Idle_Left | 4帧 | 1方向 | 待机状态 |
| Idle_Right | 4帧 | 1方向 | 待机状态 |
| Idle_Up | 4帧 | 1方向 | 待机状态 |
| Walk_Down | 6帧 | 1方向 | 行走 |
| Walk_Left | 6帧 | 1方向 | 行走 |
| Walk_Right | 6帧 | 1方向 | 行走 |
| Walk_Up | 6帧 | 1方向 | 行走 |
| Run_Down | 6帧 | 1方向 | 奔跑 |
| Run_Left | 6帧 | 1方向 | 奔跑 |
| Run_Right | 6帧 | 1方向 | 奔跑 |
| Run_Up | 6帧 | 1方向 | 奔跑 |
| Dodge_Forward | 6帧 | 4方向 | 翻滚 |
| Dodge_Backward | 4帧 | 4方向 | 后跳 |
| Dodge_Side | 6帧 | 2方向 | 闪步 |
| Block_Loop | 2帧 | 1方向 | 格挡持续 |
| Block_Hit | 4帧 | 1方向 | 格挡受击 |
| Parry | 4帧 | 1方向 | 完美格挡 |
| Attack_Basic_1 | 6帧 | 4方向 | 普通攻击第一下 |
| Attack_Basic_2 | 6帧 | 4方向 | 普通攻击第二下 |
| Attack_Basic_3 | 8帧 | 4方向 | 普通攻击第三下 |
| Attack_Heavy | 12帧 | 4方向 | 重击 |
| Attack_Heavy_Charge | 8帧 | 4方向 | 重击蓄力 |
| Hit_Light | 4帧 | 1方向 | 轻受击 |
| Hit_Heavy | 6帧 | 1方向 | 重受击 |
| Death | 10帧 | 1方向 | 死亡 |

### 8.2 动画过渡规则

| 当前动画 | 目标动画 | 过渡方式 | 过渡时间 |
|----------|----------|----------|----------|
| Idle_* | Walk_* | 交叉混合 | 0.1秒 |
| Idle_* | Run_* | 交叉混合 | 0.15秒 |
| Walk_* | Run_* | 交叉混合 | 0.1秒 |
| Run_* | Walk_* | 交叉混合 | 0.1秒 |
| Run_* | Idle_* | 交叉混合 | 0.2秒 |
| 任意 | Dodge_* | 立即切换 | 0秒 |
| 任意 | Block_* | 立即切换 | 0秒 |
| 任意 | Attack_* | 立即切换 | 0秒 |
| 任意 | Hit_* | 立即切换 | 0秒 |
| 任意 | Death | 立即切换 | 0秒 |

---

## 九、数值平衡表

### 9.1 移动速度配置

| 阶段 | 状态 | 速度(m/s) | 加速时间(s) | 减速时间(s) |
|------|------|-----------|-------------|-------------|
| 白天 | 行走 | 3.0 | 0.15 | 0.1 |
| 白天 | 奔跑 | 4.5 | 0.2 | 0.15 |
| 夜晚 | 战斗移动 | 4.0 | 0.1 | 0.08 |
| 夜晚 | 冲刺 | 6.0 | 0.15 | 0.1 |

### 9.2 闪避配置

| 类型 | 距离(m) | 速度(m/s) | 无敌帧(ms) | 冷却(s) | 消耗(耐力) |
|------|---------|-----------|------------|---------|------------|
| 翻滚 | 3.0 | 10.0 | 300 | 0.8 | 25 |
| 后跳 | 2.5 | 10.0 | 250 | 0.6 | 20 |
| 闪步 | 4.0 | 20.0 | 200 | 1.0 | 30 |

### 9.3 格挡配置

| 类型 | 伤害减免 | 完美格挡判定(ms) | 反击伤害(%) | 持续消耗(耐力/秒) |
|------|----------|-----------------|-------------|-------------------|
| 普通格挡 | 60% | - | 120% | 5（白天）/8（夜晚） |
| 完美格挡 | 100% | 100 | 150% | 0 |

---

## 十、后续扩展

### 10.1 计划中的移动能力

| 能力 | 条件 | 效果 |
|------|------|------|
| 二段闪避 | 技巧≥50 | 空中可进行第二次闪避 |
| 冲刺攻击 | 力量≥30 | 奔跑时撞开敌人 |
| 滑铲 | 技巧≥40 | 闪避时穿过低矮障碍 |
| 壁跑 | 勇气≥45 | 在墙面短暂奔跑 |
| 蹬墙跳 | 力量≥35，技巧≥35 | 墙壁借力跳跃 |
| 水下移动 | 特殊场景 | 减慢的游泳移动 |

### 10.2 可能的修改方向

1. **增加坐骑系统**：马匹、自行车等
2. **增加滑板/溜冰鞋**：特定地形的高速移动
3. **增加钩爪/绳索**：特定场景的攀爬和摆荡
4. **增加载具系统**：车辆、船只等

---

## 十一、文档修订记录

| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2026-02-03 | 初版完成 | 开发者 |

# 时间与日程系统设计

## 系统概述

时间系统是游戏的核心驱动机制，类似《女神异闻录》和《星露谷物语》，通过时间流逝推动游戏进度，玩家需要合理规划每天的活动。

**核心特点：**
- 昼夜循环：白天社交/任务，夜晚战斗
- 时间消耗：不同活动消耗不同时间
- 有限资源：每天时间有限，必须做出选择
- 进度推进：时间推进触发事件和剧情

---

## 时间流逝机制

### 时间单位

**游戏内一天 = 24小时**

**时间段划分：**
- **清晨（06:00-08:00）：** 起床，准备新的一天
- **上午（08:00-12:00）：** 主要活动时间
- **中午（12:00-14:00）：** 午餐，部分NPC休息
- **下午（14:00-18:00）：** 主要活动时间
- **傍晚（18:00-20:00）：** 晚餐，准备夜晚
- **夜晚（20:00-22:00）：** 最后的准备时间
- **深夜（22:00-06:00）：** 战斗时间或休息

### 时间流逝方式

**自动流逝：**
- 白天时间会缓慢自动流逝（可配置速度）
- 默认：游戏内1小时 = 现实2分钟
- 玩家可以在设置中调整时间流速（0.5x - 2x）

**活动消耗：**
- 执行特定活动会直接跳过相应时间
- 例如：完成一个任务消耗2小时，时间直接从10:00跳到12:00

**强制推进：**
- 22:00到达时，强制进入夜晚阶段
- 玩家必须选择：战斗或休息

---

## 活动时间消耗

### 白天活动时间表


| 活动类型 | 时间消耗 | 属性提升 | 说明 |
|---------|---------|---------|------|
| **社交互动** |
| 简单对话 | 0小时 | - | 不消耗时间，随时可进行 |
| 深度交流 | 1小时 | 魅力+1 | 与NPC深入聊天 |
| 约会/聚会 | 2小时 | 魅力+2 | 特殊社交活动 |
| **学习训练** |
| 图书馆阅读 | 2小时 | 智慧+2 | 需要安静环境 |
| 体能训练 | 2小时 | 力量+2 | 在训练场进行 |
| 射击练习 | 2小时 | 技巧+2 | 在靶场进行 |
| 冥想修行 | 2小时 | 勇气+1，智慧+1 | 特殊训练 |
| **生产制作** |
| 简单制作 | 1小时 | 技巧+1 | 制作基础物品 |
| 复杂制作 | 3小时 | 技巧+2 | 制作高级装备 |
| 烹饪 | 1小时 | 技巧+1 | 制作食物 |
| 修理装备 | 1小时 | 技巧+1 | 修复损坏装备 |
| **任务相关** |
| 简单任务 | 1-2小时 | 根据任务 | 跑腿、收集类 |
| 普通任务 | 2-3小时 | 根据任务 | 调查、护送类 |
| 困难任务 | 3-4小时 | 根据任务 | 复杂多步骤任务 |
| **商业活动** |
| 购物 | 0小时 | - | 不消耗时间 |
| 交易谈判 | 1小时 | 魅力+1，财富+1 | 大宗交易 |
| 投资管理 | 2小时 | 财富+2 | 管理产业 |
| **探索调查** |
| 小镇闲逛 | 1小时 | - | 可能触发随机事件 |
| 区域探索 | 2小时 | 勇气+1 | 探索新区域 |
| 情报收集 | 2小时 | 智慧+1 | 调查线索 |
| **休息恢复** |
| 短暂休息 | 1小时 | - | 恢复少量体力 |
| 午睡 | 2小时 | - | 恢复中等体力 |
| 娱乐放松 | 2小时 | - | 恢复精神，可能触发事件 |

### 时间消耗的灵活性

**属性影响时间消耗：**
- **技巧高：** 制作时间-20%（技巧50+）
- **智慧高：** 学习时间-20%（智慧50+）
- **魅力高：** 社交时间-20%（魅力50+）
- **力量高：** 体力劳动时间-20%（力量50+）

**道具影响：**
- 咖啡：下一个活动时间-30分钟
- 能量饮料：下一个活动时间-1小时
- 时间管理书籍：永久所有活动时间-10%

---

## 每日流程

### 标准一天流程

```
06:00 - 起床
  ↓
06:00-08:00 - 自由时间（可选活动）
  ↓
08:00-12:00 - 上午活动时段
  ├─ 可进行2-4个活动
  └─ 大部分NPC和设施开放
  ↓
12:00-14:00 - 午餐时间
  ├─ 部分设施关闭
  └─ 可以用餐恢复体力
  ↓
14:00-18:00 - 下午活动时段
  ├─ 可进行2-4个活动
  └─ 所有设施开放
  ↓
18:00-20:00 - 傍晚时段
  ├─ 准备夜晚装备
  └─ 最后的社交机会
  ↓
20:00-22:00 - 夜晚准备
  ├─ 商店关闭
  └─ 可以训练或休息
  ↓
22:00 - 强制选择
  ├─ 选项A：前往刷怪点战斗
  └─ 选项B：直接休息（跳过战斗）
  ↓
22:00-06:00 - 夜晚阶段
  ├─ 战斗：清理刷怪点，获取资源
  └─ 休息：恢复状态，时间跳转到次日
  ↓
06:00 - 新的一天开始
```

### 时间规划示例

**力量型玩家的一天：**
```
06:00 - 起床
08:00 - 训练场体能训练（2小时，力量+2）
10:00 - 接受搬运任务（2小时，力量+1，财富+50）
12:00 - 午餐（恢复体力）
14:00 - 继续训练（2小时，力量+2）
16:00 - 购买装备和补给
17:00 - 与战士型NPC交流（1小时，勇气+1）
18:00 - 晚餐
20:00 - 准备武器和道具
22:00 - 前往刷怪点战斗
02:00 - 战斗结束，回家休息
06:00 - 新的一天
```

**智慧型玩家的一天：**
```
06:00 - 起床
08:00 - 图书馆阅读（2小时，智慧+2）
10:00 - 调查任务（3小时，智慧+2，解锁线索）
13:00 - 午餐
14:00 - 研究敌人弱点（2小时，智慧+1）
16:00 - 制作科技道具（2小时，技巧+1）
18:00 - 与学者NPC交流（1小时，智慧+1）
19:00 - 晚餐
20:00 - 复习战术
22:00 - 使用策略流战斗（利用陷阱和弱点）
01:00 - 战斗结束（高效率）
06:00 - 新的一天
```

---

## NPC日程系统

### NPC时间表

每个NPC都有自己的日程安排，玩家需要在正确的时间地点找到他们。

**示例：铁匠老约翰**

| 时间 | 地点 | 状态 | 可互动内容 |
|------|------|------|-----------|
| 06:00-08:00 | 家中 | 起床 | 不可互动 |
| 08:00-12:00 | 铁匠铺 | 工作 | 购买装备、接任务、交流 |
| 12:00-13:00 | 酒馆 | 午餐 | 深度交流（好感度高时） |
| 13:00-18:00 | 铁匠铺 | 工作 | 购买装备、接任务、交流 |
| 18:00-20:00 | 家中 | 晚餐 | 不可互动 |
| 20:00-22:00 | 酒馆 | 放松 | 深度交流、特殊事件 |
| 22:00-06:00 | 家中 | 睡觉 | 不可互动 |

**特殊日程：**
- **雨天：** 某些NPC会改变日程
- **节日：** 所有NPC聚集在广场
- **特殊事件：** NPC可能临时改变位置

### NPC互动时间窗口

**好感度影响：**
- 低好感度：只能在工作时间简单交流
- 中好感度：可以在休息时间深度交流
- 高好感度：可以约NPC在特定时间见面

**特殊互动：**
- 某些剧情只在特定时间触发
- 例如：午夜在酒馆可能遇到神秘商人

---

## 天气系统

### 天气类型

| 天气 | 概率 | 影响 |
|------|------|------|
| 晴天 | 60% | 无特殊影响 |
| 阴天 | 20% | 部分NPC心情低落 |
| 雨天 | 15% | 户外活动时间+30分钟，部分NPC不出门 |
| 暴风雨 | 4% | 无法进行户外活动，夜晚敌人更强 |
| 特殊天气 | 1% | 触发特殊事件（血月、极光等） |

### 天气影响

**对活动的影响：**
- 雨天：户外训练效果-50%
- 暴风雨：无法进行户外探索
- 晴天：心情愉悦，所有活动效率+10%

**对战斗的影响：**
- 雨天：视野降低，远程武器精准度-20%
- 暴风雨：敌人数量+50%，但掉落也+50%
- 血月：敌人全属性+100%，但掉落稀有物品

---

## 特殊日期系统

### 周期性事件

**每周事件：**
- **周一：** 商人到访，特殊商品
- **周三：** 训练场开放特训课程
- **周五：** 酒馆聚会，所有NPC在场
- **周日：** 小镇集市，交易折扣

**每月事件：**
- **月初：** 小镇会议，讨论建设方向
- **月中：** 大型任务发布
- **月末：** 结算收益，发放补给

### 节日系统

**重要节日：**

**幸存者纪念日（每30天）：**
- 所有NPC好感度+5
- 特殊任务开放
- 商店大促销

**丰收节（每60天）：**
- 食物产量翻倍
- 特殊烹饪比赛
- 解锁隐藏配方

**守夜节（每90天）：**
- 夜晚敌人数量翻倍
- 奖励也翻倍
- 特殊Boss出现

---

## 时间压力与选择

### 有限时间的设计哲学

**核心理念：**
玩家无法在一周目完成所有内容，必须做出选择。

**时间压力来源：**
1. **每天时间有限：** 白天只有约12-14小时可用
2. **活动互斥：** 同一时间只能做一件事
3. **NPC时间窗口：** 错过特定时间就无法互动
4. **限时任务：** 某些任务有截止日期
5. **剧情节点：** 特定天数触发关键事件

### 选择的意义

**短期选择：**
- 今天是提升力量还是智慧？
- 是完成任务赚钱，还是社交提升好感度？
- 是探索新区域，还是巩固已有关系？

**长期选择：**
- 专精某个属性，还是均衡发展？
- 优先推进主线，还是完成支线？
- 投资哪个产业？

**选择的后果：**
- 不同选择导致不同的游戏体验
- 某些内容只有特定build才能体验
- 鼓励多周目游玩

---

## 时间管理工具

### 游戏内辅助

**日历系统：**
- 显示当前日期和星期
- 标记重要事件和任务截止日期
- 显示NPC生日和节日

**日程表：**
- 查看NPC的每日行程
- 规划自己的活动
- 设置提醒

**时间预估：**
- 接受任务前显示预计消耗时间
- 活动开始前确认时间消耗
- 避免玩家误操作

### 玩家辅助功能

**快速旅行：**
- 解锁传送点后可快速移动
- 消耗少量时间（15-30分钟）
- 避免浪费时间在路上

**时间暂停：**
- 打开菜单时时间暂停
- 玩家可以从容规划
- 战斗中时间正常流逝

**时间回溯（限定使用）：**
- 特殊道具：时光沙漏（极稀有）
- 效果：回到当天早上，保留记忆
- 用途：修正重大失误

---

## 时间与剧情推进

### 剧情节点

**固定日期触发：**
- 第7天：小镇遭遇第一次大规模袭击
- 第30天：神秘商人到访，开启新线索
- 第60天：真相逐渐浮现
- 第90天：最终决战准备

**属性触发：**
- 某个属性达到阈值时触发特殊剧情
- 例如：智慧50时，发现隐藏实验室

**好感度触发：**
- NPC好感度达到一定值触发个人剧情
- 可能解锁新的游戏内容

### 时间限制任务

**紧急任务：**
- 必须在指定时间内完成
- 失败会有严重后果（NPC死亡、区域沦陷）
- 增加紧张感

**示例：**
```
【紧急】救援任务
- 发布时间：第15天 10:00
- 截止时间：第15天 18:00
- 要求：前往东区救出被困居民
- 失败后果：3名NPC死亡，东区封锁
```

---

## 体力系统

### 体力机制

**体力值（Energy）：**
- 最大值：100
- 每个活动消耗10-30体力
- 体力为0时无法进行活动（但可以自由移动和对话）

**体力消耗表：**

| 活动类型 | 体力消耗 |
|---------|---------|
| 轻度活动（阅读、对话） | 10 |
| 中度活动（制作、训练） | 20 |
| 重度活动（战斗、探索） | 30 |

**体力恢复：**
- 用餐：+30体力
- 休息1小时：+10体力
- 睡觉：完全恢复
- 特殊食物：额外恢复

### 体力与时间的平衡

**设计目标：**
- 即使时间充足，体力不足也无法无限活动
- 玩家需要合理安排休息
- 增加策略深度

**高级玩法：**
- 力量高的玩家体力上限+20
- 某些食物可以临时提升体力上限
- 特殊技能可以降低体力消耗

---

## 时间系统UI

### 主界面显示

**屏幕顶部：**
```
[日期] 第15天 星期三 [天气] ☀️晴天
[时间] 14:30 [体力] ████████░░ 80/100
```

**时间流速指示器：**
- 显示当前时间流速
- 可以暂停/加速（非活动时）

### 日历界面

**月视图：**
```
      第1个月
一  二  三  四  五  六  日
1   2   3   4   5   6   7
8   9  10  11  12  13  14
15 [16] 17  18  19  20  21
22  23  24  25  26  27  28
29  30

[16] = 当前日期
🎯 = 有任务截止
🎉 = 节日/特殊事件
💬 = NPC特殊事件
```

### 活动选择界面

**选择活动时显示：**
```
【图书馆阅读】
消耗时间：2小时
消耗体力：10
预期收益：智慧+2
完成后时间：16:30

[确认] [取消]
```

---

## 技术实现要点

### 时间管理器

**核心功能：**
```
TimeManager {
  currentDay: int
  currentHour: float (0-24)
  timeScale: float (时间流速)
  
  AdvanceTime(hours: float)
  GetCurrentTimeSlot(): TimeSlot
  IsNPCAvailable(npcId: string): bool
  TriggerTimeEvents()
}
```

### 事件调度系统

**基于时间的事件触发：**
```json
{
  "events": [
    {
      "id": "first_attack",
      "triggerType": "day",
      "triggerValue": 7,
      "condition": "mainQuest >= 2"
    },
    {
      "id": "merchant_visit",
      "triggerType": "weekday",
      "triggerValue": 1,
      "repeating": true
    }
  ]
}
```

### 存档时间信息

**保存内容：**
- 当前日期和时间
- 天气状态
- NPC位置和状态
- 已触发的时间事件
- 玩家体力值

---

## 平衡性考虑

### 时间分配建议

**一周目标准玩家：**
- 每天2-3个主要活动
- 1-2次社交互动
- 每晚战斗1-2个刷怪点
- 每周至少1次深度任务

**时间够用但不宽裕：**
- 玩家可以完成约60-70%的内容
- 必须做出选择和取舍
- 鼓励二周目尝试不同路线

### 避免时间焦虑

**友好设计：**
- 没有真正的"Game Over"时间限制
- 主线任务时间充足
- 支线任务失败不影响通关
- 提供时间回溯道具（稀有）

**提示系统：**
- 重要事件提前提醒
- 任务截止日期明确标注
- NPC会提醒玩家重要事项

---

## 后续优化方向

### 短期（MVP阶段）

- 基础时间流逝
- 简单的活动时间消耗
- 昼夜切换
- 3-5个NPC的简单日程

### 中期

- 完整的NPC日程系统
- 天气系统
- 节日和特殊事件
- 体力系统

### 长期

- 更复杂的时间事件链
- 动态NPC日程（根据剧情变化）
- 季节系统
- 更多时间管理工具

---

**文档版本：** v1.0  
**最后更新：** 2026-02-02  
**状态：** 完成

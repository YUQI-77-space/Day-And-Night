# 战斗系统设计

## 系统概述

战斗系统是本游戏的核心玩法之一，采用**动作类实时战斗**，玩家通过武器、道具、技能进行攻击、防御、控制等操作与怪物搏杀。

**核心特点：**
- 实时动作战斗，考验操作和反应
- 深度绑定六维属性系统
- 多样化的武器和技能组合
- 肉鸽元素：随机敌人、随机掉落
- 夜晚固定刷怪点清怪模式

---

## 战斗流程

### 战斗触发

**夜晚阶段自动开始：**
1. 白天结束，时间进入夜晚（例如：22:00）
2. 玩家可以选择：
   - 直接休息（跳过战斗，但无收益）
   - 前往刷怪点战斗（获取资源和经验）
3. 小镇地图上有固定的刷怪点（初期3-5个，后期可扩展）

**刷怪点机制：**
- 每个刷怪点有难度等级（1-5星）
- 难度越高，敌人越强，奖励越好
- 玩家可以自由选择挑战哪个刷怪点
- 每晚可以挑战多个刷怪点（直到体力耗尽或选择休息）

### 战斗场景

**场景类型：**
- 废弃工厂
- 破败街区
- 地下隧道
- 郊外荒地
- 特殊事件场景（剧情相关）

**场景元素：**
- 固定地图布局（不随机）
- 可破坏的环境物体
- 可利用的掩体和高地
- 环境陷阱（可被玩家触发）

---

## 战斗核心机制

### 基础操作


| 操作 | 按键（示例） | 说明 |
|------|-------------|------|
| 移动 | WASD | 八方向移动 |
| 普通攻击 | 鼠标左键 | 根据武器类型有不同表现 |
| 重击 | 长按鼠标左键 | 蓄力攻击，伤害更高 |
| 闪避 | 空格 | 快速位移，短暂无敌帧 |
| 格挡 | 鼠标右键 | 减少伤害，可能触发反击 |
| 技能1 | Q | 主动技能槽1 |
| 技能2 | Z | 主动技能槽2 |
| 道具快捷栏 | 1-4 | 使用消耗品 |
| 切换武器 | 上下滚轮 | 在两套武器间切换 |
| 锁定目标 | 鼠标中键 | 锁定最近的敌人 |

### 战斗数值

**玩家基础属性：**
- **生命值（HP）：** 基础100，受力量影响
- **耐力值（Stamina）：** 基础100，攻击/闪避/格挡消耗
- **护甲值（Armor）：** 由装备提供，减少受到的伤害

**伤害计算公式：**
```
最终伤害 = (基础伤害 × 属性加成 × 武器系数 - 敌人护甲) × 暴击倍率 × 其他加成
```

**属性对战斗的影响：**
- **力量：** 近战伤害 +1% per point
- **技巧：** 远程伤害 +1% per point，暴击率 +0.5% per point
- **智慧：** 暴击伤害 +2% per point
- **勇气：** 血量低于50%时，伤害 +1% per point
- **魅力：** 同伴伤害 +1% per point
- **财富：** 不直接影响战斗数值，但可购买强力装备

---

## 武器系统

### 武器分类

#### 1. 近战武器

**单手剑：**
- 攻速：快
- 伤害：中
- 特点：平衡，适合新手
- 需求：力量10+

**双手剑：**
- 攻速：慢
- 伤害：高
- 特点：范围攻击，击退效果
- 需求：力量30+

**匕首：**
- 攻速：极快
- 伤害：低
- 特点：连击，背刺暴击
- 需求：技巧20+

**锤/斧：**
- 攻速：极慢
- 伤害：极高
- 特点：破甲，击晕
- 需求：力量40+

**长矛：**
- 攻速：中
- 伤害：中
- 特点：攻击距离远，可突刺
- 需求：力量20+，技巧20+

#### 2. 远程武器

**手枪：**
- 射速：快
- 伤害：低
- 特点：精准，弹药充足
- 需求：技巧15+

**霰弹枪：**
- 射速：慢
- 伤害：高（近距离）
- 特点：范围伤害，近战克星
- 需求：力量25+

**步枪：**
- 射速：中
- 伤害：中
- 特点：远距离精准射击
- 需求：技巧30+

**弓箭：**
- 射速：慢
- 伤害：高
- 特点：蓄力射击，静音
- 需求：技巧25+，力量15+

**投掷武器：**
- 飞刀、手雷、燃烧瓶等
- 一次性消耗品
- 特殊效果（爆炸、燃烧、毒素）

#### 3. 特殊武器

**科技武器：**
- 需求：智慧40+
- 激光枪、电击器、能量剑
- 特殊伤害类型

**魔改武器：**
- 需求：技巧40+，智慧30+
- 玩家自己制作的独特武器
- 可自定义属性

### 武器品质

| 品质 | 颜色 | 属性加成 | 获取方式 |
|------|------|----------|----------|
| 普通 | 白色 | 100% | 商店购买、敌人掉落 |
| 优秀 | 绿色 | 120% | 制作、任务奖励 |
| 精良 | 蓝色 | 150% | 高级制作、Boss掉落 |
| 史诗 | 紫色 | 200% | 特殊任务、稀有掉落 |
| 传奇 | 橙色 | 300% | 终极Boss、隐藏任务 |

### 武器强化

**强化系统：**
- 每把武器可强化至+10
- 每次强化提升10%基础属性
- 需要消耗材料和金钱
- 强化失败不会损坏武器，但材料消失

**武器改造：**
- 在工坊可以为武器添加配件
- 示例：瞄准镜（提高精准）、刺刀（近战伤害）、扩容弹夹（弹药量）
- 需求：技巧30+

---

## 技能系统

### 技能分类

#### 主动技能

玩家可装备2个主动技能，战斗中使用。

**力量系技能：**
- **重击（Slam）：** 跳跃后重击地面，范围伤害+击退
- **狂暴（Rage）：** 10秒内攻击力+50%，但防御-30%
- **破甲打击（Armor Break）：** 单次攻击无视护甲

**技巧系技能：**
- **连射（Rapid Fire）：** 5秒内射速+100%
- **精准射击（Precision Shot）：** 必定暴击的一击
- **影袭（Shadow Strike）：** 瞬移到敌人背后并攻击

**智慧系技能：**
- **弱点标记（Weak Point）：** 标记敌人，受到伤害+30%
- **陷阱布置（Trap）：** 放置地雷/捕兽夹
- **分析（Analyze）：** 显示敌人详细信息和攻击模式

**勇气系技能：**
- **不屈（Unyielding）：** 5秒内免疫控制和击退
- **反击（Counter）：** 格挡成功后自动反击
- **背水一战（Last Stand）：** 血量低于20%时，全属性+50%

**魅力系技能：**
- **召唤同伴（Call Ally）：** 召唤NPC协助战斗
- **鼓舞（Inspire）：** 提升队友攻击力
- **混乱（Confuse）：** 使敌人互相攻击

#### 被动技能

通过属性提升自动解锁，永久生效。

**示例：**
- **铁壁（力量30）：** 格挡时减少额外20%伤害
- **鹰眼（技巧30）：** 暴击率+10%
- **战术大师（智慧30）：** 技能冷却时间-20%
- **不死战神（勇气30）：** 致命伤害时保留1点HP（每战斗1次）
- **领袖光环（魅力30）：** 同伴存在时，全属性+10%
- **财富护体（财富30）：** 携带金钱越多，护甲越高（上限+50）

### 技能树

每个属性对应一个技能树，玩家通过提升属性解锁技能节点。

**技能点获取：**
- 每提升5点属性，获得1个技能点
- 完成特殊任务获得额外技能点
- 一周目最多获得约60个技能点

---

## 敌人系统

### 敌人分类

#### 1. 普通敌人

**变异者（Mutant）：**
- 类型：近战
- 特点：速度快，血量低
- 攻击模式：冲刺攻击、抓取

**掠夺者（Raider）：**
- 类型：远程
- 特点：使用枪械，会寻找掩体
- 攻击模式：射击、投掷手雷

**感染犬（Infected Hound）：**
- 类型：快速近战
- 特点：成群出现，速度极快
- 攻击模式：扑咬、包围

**重装兵（Heavy）：**
- 类型：坦克
- 特点：高血量高护甲，移动慢
- 攻击模式：重击、冲撞

#### 2. 精英敌人

血量和伤害是普通敌人的3倍，有特殊技能。

**狂战士（Berserker）：**
- 血量越低攻击越高
- 免疫击退

**狙击手（Sniper）：**
- 远距离高伤害
- 会改变位置

**爆破手（Demolisher）：**
- 投掷大量炸弹
- 死亡时爆炸

#### 3. Boss敌人

每个区域的最终挑战，有独特机制。

**Boss设计原则：**
- 多阶段战斗（血量降低触发新阶段）
- 需要特定策略才能高效击败
- 掉落稀有装备和材料

**示例Boss：**

**废墟之王（Ruin Lord）：**
- 阶段1：近战重击
- 阶段2：召唤小怪
- 阶段3：狂暴状态，攻速翻倍
- 弱点：智慧高的玩家可以破坏环境柱子，砸晕Boss

**腐化巨兽（Corrupted Beast）：**
- 阶段1：冲撞和践踏
- 阶段2：释放毒雾
- 阶段3：狂暴冲刺
- 弱点：技巧高的玩家可以射击弱点，造成额外伤害

### 敌人AI

**基础AI行为：**
- 巡逻：在区域内随机移动
- 警戒：发现玩家后进入战斗状态
- 追击：追逐玩家，保持攻击距离
- 撤退：血量过低时逃跑

**高级AI行为：**
- 包围：多个敌人从不同方向攻击
- 配合：近战掩护远程
- 使用掩体：远程敌人会躲避
- 呼叫支援：精英敌人会召唤增援

---

## 战斗奖励

### 掉落系统

**掉落类型：**
- 金钱（必定掉落）
- 材料（高概率）
- 装备（低概率，Boss必掉）
- 消耗品（中概率）

**掉落品质受影响因素：**
- 敌人难度
- 玩家财富属性（提高稀有度）
- 连击数（连击越高，掉落越好）
- 完美通关（无伤/快速击杀）

### 战斗评分

每次战斗结束后给予评分（D/C/B/A/S）。

**评分标准：**
- 击杀速度
- 受伤次数
- 连击数
- 技能使用多样性

**评分奖励：**
- S级：额外掉落+经验+200%
- A级：额外掉落+经验+100%
- B级：经验+50%
- C级：无额外奖励
- D级：无额外奖励

---

## 肉鸽元素

### 随机性设计

**每晚随机：**
- 刷怪点的敌人种类（从配置池中随机）
- 敌人数量（基础数量±30%）
- 精英敌人出现概率
- 特殊事件（如：商人出现、宝箱刷新）

**配置文件控制：**
```json
{
  "spawnPoint_01": {
    "difficulty": 2,
    "enemyPool": ["Mutant", "Raider", "Hound"],
    "enemyCount": {
      "min": 8,
      "max": 15
    },
    "eliteChance": 0.3,
    "bossChance": 0.05
  }
}
```

### 死亡惩罚

**玩家死亡时：**
- 保留：六维属性、主线进度、NPC关系、小镇建设
- 损失：当前携带的装备（可在死亡地点回收）、当晚获得的资源
- 惩罚：时间推进到第二天早上，损失一天时间

**装备回收机制：**
- 死亡后，装备掉落在死亡地点
- 下次前往该地点可以回收
- 如果再次死亡，之前的装备永久丢失

---

## 战斗难度

### 难度等级

**简单：**
- 敌人伤害-50%
- 敌人血量-30%
- 死亡不掉落装备

**普通：**
- 标准数值
- 死亡掉落装备但可回收

**困难：**
- 敌人伤害+50%
- 敌人血量+50%
- 死亡掉落装备，回收时间限制

**噩梦：**
- 敌人伤害+100%
- 敌人血量+100%
- 精英敌人数量翻倍
- 死亡装备永久丢失

### 动态难度

根据玩家表现自动调整：
- 连续S级评分：敌人强度+10%
- 连续死亡：敌人强度-10%
- 确保玩家始终面临挑战但不至于卡关

---

## 战斗UI

### 必要信息显示

**屏幕中央：**
- 准星/攻击指示器
- 锁定目标标记
- 伤害数字（飘字）

**屏幕左上：**
- 玩家血量条
- 耐力条
- 当前武器和弹药

**屏幕右上：**
- 小地图
- 剩余敌人数量
- 战斗时间

**屏幕下方：**
- 技能冷却时间
- 道具快捷栏
- 连击数显示

### 反馈系统

**视觉反馈：**
- 受伤时屏幕边缘变红
- 暴击时特殊特效
- 击杀时慢动作（可选）

**音效反馈：**
- 不同武器有独特音效
- 击中/暴击/格挡有明确音效
- 背景音乐随战斗强度变化

**手柄震动：**
- 攻击/受伤时震动
- 不同强度的震动反馈

---

## 技术实现要点

### 战斗系统架构

**核心模块：**
1. **输入管理器：** 处理玩家输入
2. **战斗管理器：** 协调战斗流程
3. **伤害计算器：** 处理所有伤害计算
4. **AI管理器：** 控制敌人行为
5. **掉落管理器：** 处理战利品生成

### 性能优化

**敌人数量控制：**
- 同屏最多20个敌人
- 超出视野的敌人降低更新频率
- 使用对象池管理敌人实例

**特效优化：**
- 低配置下减少粒子效果
- 远距离敌人使用简化模型

### 配置文件设计

所有战斗相关数值都应可配置：
- 武器属性
- 敌人属性
- 技能效果
- 掉落概率
- 难度系数

**示例：**
```json
{
  "weapons": {
    "sword_basic": {
      "damage": 20,
      "attackSpeed": 1.2,
      "range": 2.0,
      "staminaCost": 10,
      "requirements": {
        "strength": 10
      }
    }
  }
}
```

---

## 后续优化方向

### 短期（MVP阶段）

- 实现基础攻击/闪避/格挡
- 3-5种基础武器
- 3-5种基础敌人
- 1个刷怪点
- 简单的掉落系统

### 中期

- 完整的技能系统
- 10+种武器
- 10+种敌人
- 3-5个刷怪点
- Boss战

### 长期

- 更复杂的敌人AI
- 环境交互（破坏、陷阱）
- 多人协作模式（可选）
- 更多武器和技能
- 随机地图生成（替代固定刷怪点）

---

**文档版本：** v1.0  
**最后更新：** 2026-02-02  
**状态：** 完成

# 核心玩法循环

## 游戏主循环

```
┌─────────────────────────────────────────────────────────────┐
│                    游戏主循环（一天）                          │
│                                                               │
│  06:00 ────────────────── 18:00 ────────────────── 24:00    │
│    │          白天阶段           │        夜晚阶段        │    │
│    └─────────────────────────────┴────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

---

## 白天阶段（06:00 - 18:00）

### 核心目标
- 培养六维属性
- 完成任务和委托
- 与NPC互动建立关系
- 准备夜晚战斗所需的装备和道具
- 推进主线剧情

### 时间消耗机制

**时间流逝规则：**
- 背景时间：以实际时间比例缓慢流逝（可配置，如 1现实秒 = 1游戏分钟）
- 活动时间：执行特定活动会直接跳过一段时间
- 玩家可以随时查看当前时间和剩余时间

**活动时间消耗表（示例）：**

| 活动类型 | 消耗时间 | 主要提升属性 |
|---------|---------|------------|
| 与NPC对话（短） | 10分钟 | 魅力 |
| 与NPC深度交流 | 30分钟 | 魅力、智慧 |
| 图书馆阅读 | 1小时 | 智慧 |
| 训练场锻炼 | 1小时 | 力量、勇气 |
| 工坊制作 | 30分钟-2小时 | 技巧 |
| 商店交易 | 10分钟 | 财富 |
| 接受任务 | 5分钟 | - |
| 完成任务 | 视任务而定 | 多种 |
| 探索新区域 | 30分钟 | 勇气 |
| 休息/睡觉 | 可变 | 恢复体力 |

### 可执行活动列表

#### 1. 自由探索
- 在小镇内自由移动（不消耗时间）
- 发现隐藏地点和物品
- 触发随机事件

#### 2. NPC互动
- **普通对话**：了解NPC信息，提升好感度
- **深度交流**：解锁个人任务，获得特殊奖励
- **交易**：购买/出售物品
- **学习**：向特定NPC学习技能或知识

#### 3. 设施活动
- **图书馆**：阅读书籍提升智慧，研究敌人弱点
- **训练场**：体能训练（力量）、射击训练（技巧）、心理训练（勇气）
- **工坊**：制作装备、道具、消耗品
- **医疗站**：治疗、购买药品
- **酒馆**：收集情报、接受委托
- **商店**：购买装备和物资
- **自己的住所**：休息、整理背包、研究战利品

#### 4. 任务系统
- **主线任务**：推进剧情，必须完成
- **支线任务**：NPC委托，提升属性和好感度
- **每日委托**：可重复的小任务，快速获取资源
- **紧急事件**：随机触发，限时完成

### 白天结束条件
- 时间到达18:00自动进入夜晚准备阶段
- 玩家可以选择提前休息（跳过剩余白天时间）

---

## 夜晚阶段（18:00 - 24:00）

### 核心目标
- 击败怪物获取资源
- 测试白天培养的属性和装备
- 推进战斗相关的成长
- 生存并保护小镇

### 夜晚流程

```
18:00 - 准备阶段（5分钟）
  ├─ 检查装备和道具
  ├─ 选择出战地点
  └─ 确认准备完毕

18:05 - 战斗阶段（主要时间）
  ├─ 前往刷怪点
  ├─ 清理怪物波次
  ├─ 收集战利品
  └─ 可选：继续探索或返回

23:30 - 警告阶段
  └─ 提示玩家尽快返回安全区

24:00 - 强制结束
  ├─ 未返回：受到惩罚（损失部分资源/受伤）
  └─ 已返回：安全进入结算
```

### 刷怪点系统

**刷怪点类型：**
1. **小镇外围**（低难度）
   - 怪物等级：1-5
   - 波次：3-5波
   - 奖励：基础资源、低级装备

2. **废弃工厂**（中难度）
   - 怪物等级：5-10
   - 波次：5-7波
   - 奖励：稀有材料、中级装备

3. **地下设施**（高难度）
   - 怪物等级：10-15
   - 波次：7-10波
   - 奖励：高级材料、稀有装备

4. **未知区域**（随机难度）
   - 怪物等级：随机
   - 波次：随机
   - 奖励：随机，可能有特殊物品

**刷怪机制：**
- 每个刷怪点有固定的刷新位置（3-5个刷新点）
- 怪物种类和数量根据配置文件随机生成
- 清理完一波后，短暂休息时间（10-30秒）
- 玩家可以选择继续或撤退

### 战利品系统

**掉落类型：**
- **资源材料**：用于制作和升级
- **装备**：武器、防具、饰品
- **消耗品**：药品、buff道具
- **特殊物品**：任务道具、配方、书籍
- **货币**：用于购买物品

**掉落机制：**
- 基于配置文件的掉落表
- 稀有度：普通、稀有、史诗、传说
- 受财富属性影响（提高稀有物品掉落率）

### 死亡惩罚

**死亡时：**
- ❌ 损失：当前携带的所有战利品和消耗品
- ❌ 损失：随身装备（有一定概率保留）
- ✅ 保留：六维属性
- ✅ 保留：主线进度和NPC好感度
- ✅ 保留：已解锁的设施和配方
- ✅ 保留：存放在住所的物品

**复活机制：**
- 立即在住所复活
- 时间跳转到第二天早上
- 可以选择重试当天（消耗特殊道具）

---

## 结算与成长

### 每日结算（24:00后）

**结算内容：**
1. **属性成长**
   - 显示今日各属性的增长
   - 检查是否达到新的属性阈值
   - 解锁新的能力或选项

2. **任务进度**
   - 显示完成的任务
   - 获得任务奖励
   - 更新任务列表

3. **关系变化**
   - 显示NPC好感度变化
   - 解锁新的对话选项或任务

4. **小镇状态**
   - 小镇建设进度
   - 资源储备情况
   - 威胁等级变化

5. **战斗统计**
   - 击败的敌人数量
   - 获得的战利品
   - 战斗评价（影响额外奖励）

### 关键事件节点

**触发条件：**
- 特定天数（如第7天、第14天、第30天）
- 特定属性达到阈值
- 完成特定任务链
- 小镇状态达到特定条件

**事件类型：**
- **剧情分支**：根据六维属性选择不同的处理方式
- **Boss战**：特殊的强力敌人
- **小镇危机**：需要做出重大决策
- **NPC事件**：深化角色关系的关键时刻

---

## 玩家目标层次

### 短期目标（每天）
- 完成1-2个任务
- 提升特定属性
- 准备夜晚战斗
- 与关键NPC互动

### 中期目标（每周）
- 完成一条任务链
- 达到属性阈值解锁新内容
- 升级关键装备
- 解锁新的小镇设施

### 长期目标（整个游戏）
- 培养理想的属性组合
- 完成主线剧情
- 建设繁荣的小镇
- 拯救小镇，前往末日都市

---

## 游戏节奏设计

### 前期（第1-10天）
- **重点**：熟悉系统，探索小镇
- **难度**：低，怪物弱小
- **自由度**：高，可以随意尝试不同活动
- **目标**：找到自己喜欢的玩法风格

### 中期（第11-40天）
- **重点**：属性专精，剧情推进
- **难度**：中，需要策略和准备
- **自由度**：中，开始面临选择和取舍
- **目标**：形成自己的build，应对更强的威胁

### 后期（第41天-结局）
- **重点**：剧情高潮，最终决战
- **难度**：高，考验玩家的所有积累
- **自由度**：低，主线任务密集
- **目标**：完成最终目标，看到结局

---

## 核心循环总结

```
白天培养属性 → 夜晚测试成果 → 获得资源 → 
强化装备/解锁内容 → 推进剧情 → 面对新挑战 → 
需要更强的属性 → 回到白天培养 → ...
```

**关键设计理念：**
1. **选择与取舍**：时间有限，无法做所有事情
2. **风险与回报**：夜晚战斗越危险，奖励越丰厚
3. **长期规划**：属性培养需要持续投入
4. **即时反馈**：每个行动都有明确的收益
5. **多样性**：不同属性组合带来不同体验

---

## 下一步

- 详细设计六维属性系统（02_AttributeSystem.md）
- 详细设计战斗系统（03_CombatSystem.md）
- 设计时间管理UI和交互流程
